#version 330 core

/////////////////////////////////////////////////////////////
//////////////////////// UNIFORMS ///////////////////////////
/////////////////////////////////////////////////////////////
uniform sampler2D u_input;
uniform int u_size;

/////////////////////////////////////////////////////////////
//////////////////////// VARYING ////////////////////////////
/////////////////////////////////////////////////////////////
in vec2 v_texCoord;

/////////////////////////////////////////////////////////////
/////////////////////////// OUT /////////////////////////////
/////////////////////////////////////////////////////////////
out float o_fragColor;

/////////////////////////////////////////////////////////////
////////////////////////// MAIN /////////////////////////////
/////////////////////////////////////////////////////////////
void main() {
    vec2 texelSize = 1.0 / vec2(textureSize(u_input, 0));
    int halfSize = u_size / 2;
    float result = 0.0;
    for (int x = -halfSize; x < halfSize; ++x) {
        for (int y = -halfSize; y < halfSize; ++y) {
            vec2 offset = vec2(float(x), float(y)) * texelSize;
            result += texture(u_input, v_texCoord + offset).r;
        }
    }
    o_fragColor = result / (u_size * u_size);
}